var CarHire=CarHire||{};$("document").ready(function(){CarHire.Setup(),($("#hidCarHireResultsPage").val="True")&&CarHire.PreloadResultsSetup(!0)}),CarHire.Setup=function(){var e=int.f.GetValue("hidAutoSearch");if("True"==e&&int.f.GetObject("divSelectedCar")){var r=int.f.GetObject("divSelectedCar").innerHTML;""==r&&(int.f.Hide("divCarHireSearch"),int.f.Show("pSearchWait"),CarHire.GetCarHireHTML(!0))}$("#btnSearchAgain").on("click",function(){$("#divCarHireSearch").show(),$("#btnSearchAgain").hide()});var t=int.f.GetValue("hidCarHirePickUpDate"),i=int.f.GetValue("hidCarHireDropOffDate"),a=new Date(t.split("/")[2],t.split("/")[1]-1,t.split("/")[0]),n=new Date(i.split("/")[2],i.split("/")[1]-1,i.split("/")[0]);$("#btnAddExtras").on("click",function(){CarHire.BookExtras()});var o={ID:"#txtCarHirePickUpDate",defaultDate:a,MinDate:a,MaxDate:n,DatepickerMonths:1,Class:"carHirePickupDate"};web.DatePicker.SetupFromObject(o),o={ID:"#txtCarHireDropOffDate",defaultDate:a,MinDate:a,MaxDate:n,DatepickerMonths:1,Class:"carHireDropOffDate"},web.DatePicker.SetupFromObject(o),int.dd.SetValue("ddlCarHireLeadDriverBookingCountryID",int.f.GetValue("hidDefaultDriverCountryID"))},CarHire.Search=function(){var e=new this.searchModel,r=null;if($("select, input").removeClass("error"),e.validate())r=JSON.stringify(e.getData()),$("#divCarHireResults").hide(),$("#pSearchWait").show(),int.ff.Call("=iVectorWidgets.CarHire.GetCarHireHTML",CarHire.GetCarHireHTMLDone,r);else{for(var t=0;t<e.errors.length;t++)$("#"+e.errors[t].element).addClass("error");web.InfoBox.Show("Please check all information has been entered correctly and times are in the HH:MM format. Incorrect fields have been highlighted.","warning")}},CarHire.searchModel=function(){var e={PickUpDepotID:0,PickUpDate:new Date,PickUpTime:"",DropOffDepotID:0,DropOffDate:new Date,DropOffTime:"",LeadDriverBookingCountryID:0,TotalPassengers:0,DriverAges:[]},r={CountryID:{element:"ddlCountryID",validate:function(e){var r=!1;return r=$("#ddlCountryID").length>0?e>0:!0},error:{message:"please select a country"}},PickUpDepotID:{element:"ddlCarHirePickUpDepotID",validate:function(e){return e>0},error:{message:"please select a pick up depot"}},PickUpDate:{element:"txtCarHirePickUpDate",validate:function(e){var r=!1,t=e.split("/");if(3===t.length){var i=new Date(t[2],t[1],t[0]);r=int.d.IsDate(i)}return r},error:{message:"please select a valid pick up date"}},PickUpTime:{element:"txtCarHirePickUpTime",validate:function(e){return int.v.IsTime(e)},error:{message:"please select a valid pick up time"}},DropOffDepotID:{element:"ddlCarHireDropOffDepotID",validate:function(e){return e>0},error:{message:"please select a drop off depot"}},DropOffDate:{element:"txtCarHireDropOffDate",validate:function(e){var r=!1,t=e.split("/");if(3===t.length){var i=new Date(t[2],t[1],t[0]);r=int.d.IsDate(i)}return r},error:{message:"please select a valid drop off date"}},DropOffTime:{element:"txtCarHireDropOffTime",validate:function(e){return int.v.IsTime(e)},error:{message:"please select a valid drop off time"}},LeadDriverBookingCountryID:{element:"ddlCarHireLeadDriverBookingCountryID",validate:function(e){return e>0},error:{message:"please select a lead guest booking country"}},TotalPassengers:{element:"ddlCarHireTotalPassengers",validate:function(e){return e>0},error:{message:"please select total passengers"}},DriverAges:{element:"ddlCarHireDriverAge",validate:function(e){return e>0},error:{message:"please select main drivers age"}}};for(prop in r){var t=$("#"+r[prop].element).val();int.a.IsArray(e[prop])?e[prop].push(t):e[prop]=t}return{validate:function(){for(prop in e){var t=r[prop];t.validate(e[prop])||this.errors.push({message:t.error.message,element:t.element})}return 0===this.errors.length},getData:function(){return e},errors:[]}},CarHire.GetCarHireHTML=function(e){var r=!1;e&&(r=!0),int.ff.Call("=iVectorWidgets.CarHire.GetCarHireHTML",function(e){CarHire.GetCarHireHTMLDone(e,r)})},CarHire.GetCarHireHTMLDone=function(e,r){var t=JSON.parse(e);t.Success?(int.f.SetHTML("divCarHireResults",t.HTML),$("#pSearchWait").hide(),$("#divCarHireResults").show(),$("#btnAddCar").on("click",function(){CarHire.Select()}),"True"!=int.f.GetValue("hidUseBasketCarHire")&&$("#divSelectedCar").hide(),r&&$("#btnSearchAgain").show()):(""!=int.f.GetValue("hidSearchWarning")?(int.f.Show("divCarHireResults"),int.f.Show("divCarHireSearch"),int.f.SetHTML("divCarHireResults",'<p class="noResults">'+int.f.GetValue("hidSearchWarning")+"</p>")):(int.f.Show("divCarHireResults"),int.f.Show("divCarHireSearch"),int.f.SetHTML("divCarHireResults",'<p class="noResults">'+t.Warning+"</p>")),$("#pSearchWait").hide())},CarHire.PreloadResultsSetup=function(e){$("#pSearchWait").hide(),$("#btnAddCar").on("click",function(){CarHire.Select()}),"True"!=int.f.GetValue("hidUseBasketCarHire")&&$("#divSelectedCar").hide(),e&&$("#btnSearchAgain").show(),CarHire.Bind()},CarHire.Bind=function(){var e=$("#hidCarHireSearchJSON").val();if(""!=e){JSON.parse(e)}},CarHire.Select=function(){var e=int.f.GetObjectsByIDPrefix("rad_ch_","input","divCarHireResults"),r="";for(i=0;i<e.length;i++)$(e[i]).is(":checked")&&(r=e[i].id.split("_")[2]);r?CarHire.AddCar(r,null,CarHire.AddCarCompleteAlt):web.InfoBox.Show("Please select a car","warning")},CarHire.CheckboxSelect=function(e){{var r=e.id,t=e.id.split("_")[2];int.f.GetObjectsByIDPrefix("chk_ch_","input")}int.cb.Checked(e)?CarHire.AddCar(t,r,CarHire.AddCarComplete):int.ff.Call("=iVectorWidgets.CarHire.RemoveCarHire",function(e){CarHire.RemoveCarComplete(e)})},CarHire.AddCar=function(e,r,t){int.ff.Call("=iVectorWidgets.CarHire.AddCarHireToBasket",function(e){t(e,r)},e)},CarHire.AddCarComplete=function(e,r){var t=JSON.parse(e),a=int.f.GetObjectsByIDPrefix("chk_ch_","input","divCarHireResults");if(t.Success)for(i=0;i<a.length;i++)a[i].id!=r&&(int.f.RemoveClass(a[i],"selected"),int.cb.SetValue(a[i],"false"));else{for(i=0;i<a.length;i++)int.f.RemoveClass(a[i],"selected"),int.cb.SetValue(a[i],"false");web.InfoBox.Show(t.Warnings,"warning")}Basket.UpdateBasketHTML()},CarHire.AddCarCompleteAlt=function(e,r){var t=JSON.parse(e);if(t.Success){if(t.Redirect===!0)return void(window.location=t.RedirectUrl);$("#divCarHireResults").hide(),int.ff.Call("=iVectorWidgets.CarHire.GetSelectedCarHireAndExtras",function(e){CarHire.GetSelectedCarDone(e)})}else web.InfoBox.Show(t.Warnings,"warning");Basket.UpdateBasketHTML()},CarHire.GetSelectedCarHireHTML=function(){int.ff.Call("=iVectorWidgets.CarHire.GetSelectedCarHireAndExtras",function(e){CarHire.GetSelectedCarDone(e)})},CarHire.GetSelectedCarDone=function(e){$("#divSelectedCar").html(e),$("#divSelectedCar").show(),$("#btnAddExtras").on("click",function(){CarHire.BookExtras()}),$("#btnRemoveCarHire").on("click",function(){CarHire.RemoveCarHire()})},CarHire.UpdateindividualCarHireExtra=function(e,r){var t=[];t.push(e.id.split("_")[1]+"###"+r),int.ff.Call("=iVectorWidgets.CarHire.AddExtrasToBasket",function(e){CarHire.BookExtrasComplete(e)},JSON.stringify(t))},CarHire.BookExtras=function(){var e=[],r=$(".bookableExtras select");for(i=0;i<r.length;i++)e.push(r[i].id.split("_")[3]+"###"+r[i].value);int.ff.Call("=iVectorWidgets.CarHire.AddExtrasToBasket",function(e){CarHire.BookExtrasComplete(e)},JSON.stringify(e))},CarHire.BookExtrasComplete=function(e){CarHire.GetSelectedCarDone(e),Basket.UpdateBasketHTML()},CarHire.UpdateExtras=function(){for(aCarHireExtras=int.f.GetObjectsByIDPrefix("ddl_ch_extra_","select","divSelectedCar"),i=0;i<aCarHireExtras.length;i++){var e=int.n.SafeInt(int.f.GetHTML("spnExtraPrice_"+i)),r=int.dd.GetValue(aCarHireExtras[i].id),t=e*r;int.f.SetHTML("spnCarHireExtraTotal_"+i,t)}CarHire.BookExtras()},CarHire.RemoveCarHire=function(){int.ff.Call("=iVectorWidgets.CarHire.RemoveCarHire",function(e){CarHire.RemoveCarComplete(e)})},CarHire.RemoveCarComplete=function(e){var r=JSON.parse(e);if(r.Success)if(int.f.GetObject("divSelectedCar"))int.f.Hide("divSelectedCar");else{var t=int.f.GetObjectsByIDPrefix("chk_ch_","input");for(i=0;i<t.length;i++)int.f.RemoveClass(t[i],"selected"),int.cb.SetValue(t[i],"false")}Basket.UpdateBasketHTML()},CarHire.ShowMoreOptions=function(){var e=int.f.GetElementsByClassName("tr","option","tblResults");for(i=0;i<e.length;i++)int.f.Show(e[i]);int.f.Show("aHideExtraOptions"),int.f.Hide("aShowExtraOptions")},CarHire.HideMoreOptions=function(){var e=int.f.GetElementsByClassName("tr","option","tblResults");for(i=0;i<e.length;i++)int.f.Hide(e[i]);int.f.Hide("aHideExtraOptions"),int.f.Show("aShowExtraOptions")},CarHire.ShowInfo=function(e){web.ModalPopup.Show("divRentalConditionsWaiting"),int.ff.Call("=iVectorWidgets.CarHire.InformationPrebook",function(r){CarHire.ShowInfoComplete(r,e)},e)},CarHire.ShowInfoComplete=function(e,r){var t=JSON.parse(e);web.ModalPopup.Hide("divRentalConditionsWaiting"),t.Success?web.ModalPopup.Show(t.HTML,!0,"modalpopup rentalConditions"):web.ModalPopup.Show('<p class="error">'+t.Warning+"</p>",!0)},CarHire.ResetForm=function(e){for(var r=int.f.GetElementsByClassName("*","error","divCarHire"),t=0;t<r.length;t++)int.f.RemoveClass(r[t],"error");null!=e&&void 0!=e&&e()},CarHire.SelectCountry=function(e){e>0?CarHire.SetDepotDropdown(e):(int.dd.SetValue("ddlCarHirePickUpDepotID",""),int.f.GetObject("ddlCarHirePickUpDepotID").disabled=!0,int.dd.SetValue("ddlCarHireDropOffDepotID",""),int.f.GetObject("ddlCarHireDropOffDepotID").disabled=!0)},CarHire.SetDepotDropdown=function(e){int.ff.Call("=iVectorWidgets.CarHire.GetCarHireDepotHTML",function(e){CarHire.SetDepotDropdown_Done(e)},e)},CarHire.SetDepotDropdown_Done=function(e){int.f.GetObject("ddlCarHirePickUpDepotID").disabled=!1,int.f.SetHTML("ddlCarHirePickUpDepotID",e),int.f.GetObject("ddlCarHireDropOffDepotID").disabled=!1,int.f.SetHTML("ddlCarHireDropOffDepotID",e)},CarHire.ValidateBasket=function(e){int.ff.Call("=iVectorWidgets.CarHire.ValidateBasket",function(r){CarHire.ValidateBasket_Done(r,e)})},CarHire.ValidateBasket_Done=function(e,r){return 0==e?(web.InfoBox.Show("Please select a car","warning"),!1):(r(),!0)};