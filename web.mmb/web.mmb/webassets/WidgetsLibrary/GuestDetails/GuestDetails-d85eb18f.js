var GuestDetails=GuestDetails||{};GuestDetails.CompleteFunction=null,GuestDetails.Validate=function(e){web.InfoBox.Close(),GuestDetails.CompleteFunction=e,GuestDetails.WarningMessage="",GuestDetails.ValidateNames(),GuestDetails.ValidateDOBs(),GuestDetails.CheckForErrors()},GuestDetails.CheckForErrors=function(){var e=int.f.GetElementsByClassName("","error","divGuestDetails");0==e.length?GuestDetails.AddToBasket():(GuestDetails.ShowWarning(e),null!=GuestDetails.CompleteFunction&&void 0!=GuestDetails.CompleteFunction&&GuestDetails.CompleteFunction())},GuestDetails.ShowWarning=function(e){var t=int.f.GetValue("hidGuestDetails_MissingFields"),a=int.f.GetValue("hidGuestDetails_DOBWarning"),s=new Array;if(""!=a)for(var i=0;i<e.length;i++)int.s.StartsWith(e[i].id,"ddlDOB")&&s.push(e[i]);s.length>0&&s.length==e.length?web.InfoBox.Show(a,"warning"):e.length>0&&s.length>0&&s.length!=e.length?web.InfoBox.Show(t+"</br>"+a,"warning"):0==s.length&&e.length>0&&web.InfoBox.Show(t,"warning")},GuestDetails.ValidateNames=function(){GuestDetails.ValidateNameType("txtGuestDetailsFirstName_","hisGuestDetails_FirstNamePlaceholder"),GuestDetails.ValidateNameType("txtGuestDetailsLastName_","hisGuestDetails_LastNamePlaceholder")},GuestDetails.ValidateNameType=function(e,t){var a=int.f.GetObjectsByIDPrefix(e,"input","divGuestDetails");a.forEach(function(e){var a=int.f.GetValue(e);int.f.SetClassIf(e,"error",""==a||a==int.f.GetValue(t)||!int.v.IsAlpha(a))})},GuestDetails.ValidateDOBs=function(){if("true"==int.f.GetValue("hidGuestDetails_RequiresDOB")||"true"==int.f.GetValue("hidGuestDetails_RequiresInfantDOB")){var e=int.f.GetObjectsByIDPrefix("ddlDOB","select","divGuestDetails");e.forEach(function(e){int.f.SetClassIf(e,"error",0==int.dd.GetIntValue(e))})}},GuestDetails.ValidateChildAges=function(){var e=GuestDetails.TryGetFirstDepartureDateOtherwiseTodaysDate(),t=int.f.GetElementsByClassName("span","childDOB","divGuestDetails");t.forEach(function(t){var a=t.id.slice(t.id.indexOf("_"));GuestDetails.ValidateChildInfantAges(a,e)})},GuestDetails.ValidateInfantAges=function(){var e=GuestDetails.TryGetFirstDepartureDateOtherwiseTodaysDate(),t=int.f.GetElementsByClassName("span","infantDOB","divGuestDetails");t.forEach(function(t){var a=t.id.slice(t.id.indexOf("_"));GuestDetails.ValidateChildInfantAges(a,e)})},GuestDetails.ValidateChildInfantAges=function(e,t){var a=int.dd.GetValue("ddlDOBDay"+e),s=int.dd.GetValue("ddlDOBMonth"+e),i=int.dd.GetValue("ddlDOBYear"+e);if(""!=a&&""!=s&&""!=i&&""!=t){var l=GuestDetails.CalculateAge(new Date(i,s-1,a),t),n=void 0==int.f.SafeObject("pChildAge"+e)?0:parseInt(int.f.SafeObject("pChildAge"+e).innerText);(n>1&&l!=n||0==n&&l>1)&&(int.f.SetClass("ddlDOBDay"+e,"error"),int.f.SetClass("ddlDOBMonth"+e,"error"),int.f.SetClass("ddlDOBYear"+e,"error"))}},GuestDetails.TryGetFirstDepartureDateOtherwiseTodaysDate=function(){var e=new Date,t=int.f.GetValue("hidGuestDetails_FirstDepartureDate");if(""!=t){var a=t.substring(0,2),s=t.substring(3,5),i=t.substring(6,10);e=new Date(i,s,a)}return e.setHours(0,0,0,0),e},GuestDetails.CalculateAge=function(e,t){var a=t.getFullYear()-e.getFullYear(),s=t.getMonth()-e.getMonth();return(0>s||0===s&&t.getDate()<e.getDate())&&a--,a},GuestDetails.CapitaliseFirstLetter=function(e){var t=e.value,a=int.s.Left(t,1),s=int.s.Substring(t,1,t.length);int.f.SetValue(e,a.toUpperCase()+s)},GuestDetails.CopyLastName=function(e,t){var a=int.f.SafeObject("txtGuestDetailsLastName_"+e+"_1"),s=int.f.SafeObject("txtGuestDetailsLastName_"+e+"_"+t);""!=a.value&&int.f.SetValue(s,a.value)},GuestDetails.ToggleCollapse=function(e){atds=int.f.GetElementsByClassName("td","collapsible",e.parentElement),int.f.ToggleClass(e,"collapsed");for(var t=0;t<atds.length;t++)int.f.Toggle(atds[t]),int.f.ToggleClass(atds[t],"hidden")},GuestDetails.SetupPlaceholders=function(){GuestDetails.AttachPlaceholders("txtGuestDetailsFirstName_","hisGuestDetails_FirstNamePlaceholder"),GuestDetails.AttachPlaceholders("txtGuestDetailsMiddleName_","hisGuestDetails_MiddleNamePlaceholder"),GuestDetails.AttachPlaceholders("txtGuestDetailsLastName_","hisGuestDetails_LastNamePlaceholder")},GuestDetails.AttachPlaceholders=function(e,t){var a=int.f.GetObjectsByIDPrefix(e,"input","divGuestDetails");a.forEach(function(e){web.Placeholder.AttachEvents(e,int.f.GetValue(t))})},GuestDetails.AddToBasket=function(){var e={RequiresDOB:"true"==int.f.GetValue("hidGuestDetails_RequiresDOB"),RequiresInfantDOB:"true"==int.f.GetValue("hidGuestDetails_RequiresInfantDOB"),Rooms:[]};for(iRoomCount=int.f.GetIntValue("hidGuestDetails_RoomCount"),a=1;a<=iRoomCount;a++){var t={RoomNumber:a,Guests:[]};for(iRoomPaxCount=int.f.GetIntValue("hidGuestDetails_PaxCount_"+a),b=1;b<=iRoomPaxCount;b++){var s={GuestType:int.f.GetValue("hidGuestDetailsType_"+a+"_"+b),Title:int.dd.GetValue("ddlGuestDetailsTitle_"+a+"_"+b),FirstName:int.f.GetValue("txtGuestDetailsFirstName_"+a+"_"+b),MiddleName:int.f.GetValue("txtGuestDetailsMiddleName_"+a+"_"+b),LastName:int.f.GetValue("txtGuestDetailsLastName_"+a+"_"+b)};if(e.RequiresDOB||e.RequiresInfantDOB&&"Infant"==s.GuestType){var i=int.d.New(int.dd.GetIntValue("ddlDOBDay_"+a+"_"+b),int.dd.GetIntValue("ddlDOBMonth_"+a+"_"+b),int.dd.GetIntValue("ddlDOBYear_"+a+"_"+b));int.d.TimeZoneSafeDate(i),s.DateOfBirth=i}t.Guests.push(s)}e.Rooms.push(t)}int.ff.Call("=iVectorWidgets.GuestDetails.AddToBasket",GuestDetails.AddToBasketComplete,JSON.stringify(e))},GuestDetails.AddToBasketComplete=function(e){if("incomplete"==e)web.InfoBox.Show("Please fill in all fields to continue","warning");else try{var t=JSON.parse(e);if(t.Success)null!=GuestDetails.CompleteFunction&&void 0!=GuestDetails.CompleteFunction&&GuestDetails.CompleteFunction();else for(var a=0;a<t.Warnings.length;a++)web.InfoBox.Show(t.Warnings[a],"warning")}catch(s){web.InfoBox.Show("Sorry, an unexpected error occurred.","warning")}},$(document).ready(function(){GuestDetails.SetupPlaceholders()});