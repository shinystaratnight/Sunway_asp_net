var CompleteBooking=CompleteBooking||{};CompleteBooking.CurrentValidateScript=0,CompleteBooking.ValidationScripts=new Array,CompleteBooking.CompleteFunction=null;var bookingTimeout,bTimeoutRunning=!1,bTimeoutMessageShown=!1;CompleteBooking.ValidateScripts=function(e,o){""!=e?(CompleteBooking.CurrentValidateScript=0,CompleteBooking.ValidationScripts=e.split("#"),CompleteBooking.CompleteFunction=o,CompleteBooking.ValidateNext()):(CompleteBooking.CompleteFunction=o,CompleteBooking.Validate())},CompleteBooking.ValidateNext=function(){if(CompleteBooking.CurrentValidateScript+=1,CompleteBooking.CurrentValidateScript<=CompleteBooking.ValidationScripts.length){var e=CompleteBooking.ValidationScripts[CompleteBooking.CurrentValidateScript-1];setTimeout(e+"(CompleteBooking.ValidateNext)",0)}else CompleteBooking.Validate()},CompleteBooking.Validate=function(){var e=int.f.GetElementsByClassName("","error","divAll").length;if(0==e)void 0!=CompleteBooking.CompleteFunction&&CompleteBooking.CompleteFunction();else{var o=int.f.GetValue("hidInsertWarningAfter");""!==o?web.InfoBox.Show(int.f.GetValue("hidWarningMessage"),"warning",null,o):web.InfoBox.Show(int.f.GetValue("hidWarningMessage"),"warning")}},CompleteBooking.SearchToMainBasket=function(){WaitMessage.Show("PreBook"),int.ff.Call("=iVectorWidgets.CompleteBooking.SearchToMainBasket",CompleteBooking.SearchToMainBasketComplete)},CompleteBooking.SearchToMainBasketComplete=function(e){"Fail"==e?(WaitMessage.Hide(),web.Window.Redirect("/booking-summary?warn=prebookfailed")):-1!=int.f.GetValue("hidRedirectURL").indexOf("/payment")?CompleteBooking.PreBookNoCopy():web.Window.Redirect(int.f.GetValue("hidRedirectURL"))},CompleteBooking.AddComponentSearchShow=function(){int.ff.Call("=iVectorWidgets.CompleteBooking.SearchToMainBasket",CompleteBooking.AddComponentSearchShowComplete)},CompleteBooking.AddComponentSearchShowComplete=function(){SearchTool.Expand()},CompleteBooking.PreBook=function(){WaitMessage.Show("PreBook"),int.ff.Call("=iVectorWidgets.CompleteBooking.PreBook",CompleteBooking.PreBookComplete)},CompleteBooking.PreBookNoCopy=function(){WaitMessage.Show("PreBook"),int.ff.Call("=iVectorWidgets.CompleteBooking.PreBookNoCopy",CompleteBooking.PreBookComplete)},CompleteBooking.PreBookComplete=function(e){var o=JSON.parse(e);if(0==o.OK){var t=int.f.GetValue("hidFailURL");WaitMessage.Hide(),web.Window.Replace(""!==t?t+o.RedirectString:"/booking-summary?warn=prebookfailed")}else{var i=int.f.GetValue("hidRedirectURL");web.Window.Redirect(null!==o.RedirectString?i+o.RedirectString:i)}},CompleteBooking.Book=function(){WaitMessage.Show("Book"),int.ff.Call("=iVectorWidgets.CompleteBooking.Book",CompleteBooking.BookComplete),"true"==int.f.GetValue("hidShowTimeoutMessage")&&(bookingTimeout=setTimeout(function(){CompleteBooking.ShowTimeoutMessage("Book")},12e4),bTimeoutRunning=!0)},CompleteBooking.BookComplete=function(e){bTimeoutRunning&&clearTimeout(bookingTimeout);var o=JSON.parse(e);if(!bTimeoutMessageShown)if(1==o.SecureEnrollment)web.Window.Redirect("/paymentauthorisation");else if(0==o.OK){var t=int.f.GetValue("hidFailURL");WaitMessage.Hide(),web.Window.Replace(""!=t?t+o.RedirectString:"/payment?warn=bookfailed")}else{var i=int.f.GetValue("hidRedirectURL");web.Window.Redirect(null!==o.RedirectString?i+o.RedirectString:i)}},CompleteBooking.UpdatePrice=function(e){var o=int.f.GetValue("hidCompleteBooking_CurrencySymbol"),t=int.f.GetValue("hidCompleteBooking_CurrencyPosition");if(int.f.GetObject("strTotalPrice")){if(int.f.SetHTML(strTotalPrice,int.n.FormatMoney(e.TotalPriceUnformated,o,t)),int.f.SetHTML(strDepositPrice,int.n.FormatMoney(e.DepositAmountUnformated,o,t)),int.f.GetObject("strSurcharge"))if(e.Surcharge&&0!=e.Surcharge){var i=e.TotalPriceSurchargeAmount,n=e.DepositPriceSurchargeAmount;int.f.SetHTML("strSurcharge","Credit Card Fee Applied ("+int.n.FormatNumber(e.Surcharge,2)+"%) : "+int.n.FormatMoney(i,o,t)),int.f.GetObject("strDepositSurcharge")&&int.f.SetHTML("strDepositSurcharge","Credit Card Fee Applied To Deposit ("+int.n.FormatNumber(e.Surcharge,2)+"%) : "+int.n.FormatMoney(n,o,t))}else int.f.SetHTML("strSurcharge",""),int.f.GetObject("strDepositSurcharge")&&int.f.SetHTML("strDepositSurcharge","")}else int.f.GetObject("spnBasketTotal")&&int.f.SetHTML("spnBasketTotal",int.n.FormatMoney(e.TotalPriceUnformated,int.f.GetValue("hidCompleteBooking_CurrencySymbol"),int.f.GetValue("hidCompleteBooking_CurrencyPosition")));e.FlightSupplierFee>0&&int.f.SetHTML("spnFlightFee","Flight Fees Applied : "+int.n.FormatMoney(e.FlightSupplierFee,o,t))},CompleteBooking.ShowTimeoutMessage=function(e){WaitMessage.ShowTimeout(e),bTimeoutMessageShown=!0};