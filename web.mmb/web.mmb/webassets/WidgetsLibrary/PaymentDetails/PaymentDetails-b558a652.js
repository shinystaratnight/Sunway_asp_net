var PaymentDetails=PaymentDetails||{},me=this;web.PubSub.subscribe("PromoCode.ChangeSuccess",function(){PaymentDetails.CreditCardSelect()}),PaymentDetails.CompleteFunction=null,PaymentDetails.PerformValidation=!0,PaymentDetails.SetPaymentType=function(){var e=int.cb.Checked("radPayByCard"),t=int.f.GetValue("hidUseBillingAddress");int.f.ShowIf("divPaymentDetails",0==e),int.f.ShowIf("divPaymentDetails",1==e),int.f.ShowIf("divBillingAddress",1==e&&"true"==t)},PaymentDetails.Validate=function(e){if(PaymentDetails.PerformValidation=int.f.GetValue("hidPerformValidation"),PaymentDetails.CompleteFunction=e,void 0!=int.f.GetObject("divPaymentDetails")&&"true"==PaymentDetails.PerformValidation){for(var t=int.f.GetElementsByClassName("*","error",int.f.GetObject("divPaymentDetails")),i=0;i<t.length;i++)int.f.RemoveClass(t[i],"error");var n=int.f.GetValue("txtCCCardNumber"),a=(int.f.GetIntValue("txtPayment_CSV"),int.dd.GetValue("ddlCCExpireMonth")),r=int.dd.GetValue("ddlCCExpireYear");int.f.SetClassIf("ddlCCCardTypeID","error",0==int.dd.GetIntValue("ddlCCCardTypeID")),int.f.SetClassIf("txtCCCardNumber","error",!int.v.IsCardNumber(n)||""==n||0==int.n.SafeInt(n)),int.f.SetClassIf("txtCCCardHoldersName","error",""==int.f.GetValue("txtCCCardHoldersName")),int.f.SetClassIf("ddlCCExpireMonth","error",""==a||!int.v.IsNumeric(a)),int.f.SetClassIf("ddlCCExpireYear","error",""==r||!int.v.IsNumeric(r)),PaymentDetails.ValidateCSV();var l=int.cb.Checked("radPayByCard"),d=int.f.GetValue("hidUseBillingAddress");l&&"true"==d&&(int.f.SetClassIf("ddlBillingAddress_Title","error",0==int.dd.GetIndex("ddlBillingAddress_Title")),int.f.SetClassIf("txtBillingAddress_FirstName","error",""==int.f.GetValue("txtBillingAddress_FirstName")),int.f.SetClassIf("txtBillingAddress_LastName","error",""==int.f.GetValue("txtBillingAddress_LastName")),int.f.SetClassIf("txtBillingAddress_Address","error",""==int.f.GetValue("txtBillingAddress_Address")),int.f.SetClassIf("txtBillingAddress_City","error",""==int.f.GetValue("txtBillingAddress_City")),int.f.SetClassIf("txtBillingAddress_Postcode","error",""==int.f.GetValue("txtBillingAddress_Postcode")),int.f.SetClassIf("ddlBillingAddress_BookingCountry","error",0==int.dd.GetIndex("ddlBillingAddress_BookingCountry")));var s=int.f.GetElementsByClassName("","error","divPaymentDetails").length;l&&"true"==d&&(s+=int.f.GetElementsByClassName("","error","divBillingAddress").length),0==s?PaymentDetails.AddDetailsToBasket():PaymentDetails.AddDetailsToBasketComplete()}else int.ff.Call("=iVectorWidgets.PaymentDetails.ExcludePaymentDetails",PaymentDetails.AddDetailsToBasketComplete)},PaymentDetails.ValidateCSV=function(){var e=document.getElementById("txtCCSecurityCode").getAttribute("validation-required"),e="true"==e||null==e;int.f.SetClassIf("txtCCSecurityCode","error",""==int.f.GetValue("txtCCSecurityCode")&&e)},PaymentDetails.MMBValidate=function(){if(void 0!=int.f.GetObject("divPaymentDetails")){for(var e=int.f.GetElementsByClassName("*","error",int.f.GetObject("divPaymentDetails")),t=0;t<e.length;t++)int.f.RemoveClass(e[t],"error");var i=int.f.GetValue("txtCCCardNumber"),n=(int.f.GetIntValue("txtPayment_CSV"),int.dd.GetValue("ddlCCExpireMonth")),a=int.dd.GetValue("ddlCCExpireYear"),r=int.f.GetValue("txtAmount"),l=int.f.GetValue("txtAmountDueNow");int.f.SetClassIf("ddlCCCardTypeID","error",0==int.dd.GetValue("ddlCCCardTypeID")),int.f.SetClassIf("txtCCCardNumber","error",!int.v.IsCardNumber(i)||""==i),int.f.SetClassIf("txtCCCardHoldersName","error",""==int.f.GetValue("txtCCCardHoldersName")),int.f.SetClassIf("ddlCCExpireMonth","error",""==n||!int.v.IsNumeric(n)),int.f.SetClassIf("ddlCCExpireYear","error",""==a||!int.v.IsNumeric(a)),int.f.SetClassIf("txtCCSecurityCode","error",""==int.f.GetValue("txtCCSecurityCode")&&int.f.Visible("txtCCSecurityCode")),int.f.SetClassIf("txtAmount","error",0==int.n.SafeNumeric(r));var d=!1;int.n.SafeNumeric(r)>0&&int.n.SafeNumeric(r)<50&&int.n.SafeNumeric(l)>=50&&(d=!0);var s=!1;int.n.SafeNumeric(l)<50&&int.n.SafeNumeric(r)<int.n.SafeNumeric(l)&&(s=!0);var o=int.f.GetElementsByClassName("","error","divPaymentDetails").length;o>0?web.InfoBox.Show("Please ensure that all required fields are set. Incorrect fields have been highlighted.","warning",null,"divCountDown"):1==d?web.InfoBox.Show("A minimum payment of 50 euros is required.","warning",null,"divCountDown"):s?web.InfoBox.Show("A minimum payment of 50 euros or your deposit/balance (whichever is lower) is required.","warning",null,"divCountDown"):PaymentDetails.MakePayment()}},PaymentDetails.AddDetailsToBasket=function(){var e=int.f.GetContainerQueryString("divPaymentDetails"),t=int.cb.Checked("radPayByCard"),i=int.f.GetValue("hidUseBillingAddress");t&&"true"==i&&(e=e+"&"+int.f.GetContainerQueryString("divBillingAddress"),e=e+"&ddlBillingAddress_BookingCountryID="+int.dd.GetIndex("ddlBillingAddress_BookingCountry")),int.ff.Call("=iVectorWidgets.PaymentDetails.AddDetailsToBasket",PaymentDetails.AddDetailsToBasketComplete,e)},PaymentDetails.AddDetailsToBasketComplete=function(){null!=PaymentDetails.CompleteFunction&&void 0!=PaymentDetails.CompleteFunction&&PaymentDetails.CompleteFunction()},PaymentDetails.MakePayment=function(){var e=int.f.GetContainerQueryString("divPaymentDetails");int.f.GetObject("txtAmount")&&int.f.AddClass("txtAmount","paying"),int.ff.Call("=iVectorWidgets.PaymentDetails.MakePayment",PaymentDetails.MakePaymentCompleteComplete,e)},PaymentDetails.MakePaymentCompleteComplete=function(e){int.f.GetObject("txtAmount")&&int.f.RemoveClass("txtAmount","paying"),"True"==e?web.Window.Redirect("/view-booking"):web.InfoBox.Show("Sorry, there was an error with your payment. Please contact us.","warning",null,"divCountDown")},PaymentDetails.CreditCardSelect=function(){var e=int.dd.GetValue("ddlCCCardTypeID");int.ff.Call("=iVectorWidgets.PaymentDetails.CreditCardSelect",PaymentDetails.CreditCardSelect_Callback,e)},PaymentDetails.CreditCardSelect_Callback=function(e){var t=JSON.parse(e);int.f.SetValue(hidSurcharge,t.Surcharge),int.f.SetValue(hidTotalAmount,t.TotalPriceUnformated),int.f.ShowIf("txtCCSecurityCode",t.RequiresCSV),int.f.ShowIf("dtSecruityCode",t.RequiresCSV),int.f.ShowIf("aPayment_CSVTooltip",t.RequiresCSV),t.RequiresCSV||int.f.SetValue("txtCCSecurityCode","");var i=int.f.GetValue("hidDisablePriceUpdate");"True"!==i&&CompleteBooking.UpdatePrice(t)};